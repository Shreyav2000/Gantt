<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVPL Navigation Restructuring - Project Timeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #2196f3;
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }

        .skip-link:focus {
            top: 0;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 26px;
        }

        .project-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .project-info p {
            margin-bottom: 5px;
            color: #1565c0;
            font-size: 14px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 500;
            color: #546e7a;
            font-size: 14px;
        }

        .control-group input {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            padding: 8px 16px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .btn:hover,
        .btn:focus {
            background: #1976d2;
            outline: 2px solid #1565c0;
            outline-offset: 2px;
        }

        .btn.export {
            background: #4caf50;
        }

        .btn.export:hover,
        .btn.export:focus {
            background: #388e3c;
            outline-color: #2e7d32;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 35px;
            height: 20px;
            border-radius: 3px;
        }

        .gantt-wrapper {
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .gantt-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1400px;
        }

        .gantt-table th {
            background: #37474f;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            border-right: 1px solid #546e7a;
            border-bottom: 2px solid #263238;
        }

        .gantt-table th:first-child {
            text-align: left;
            padding-left: 15px;
            min-width: 280px;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        .gantt-table td {
            border: 1px solid #e0e0e0;
            padding: 6px;
            vertical-align: middle;
        }

        .gantt-table tr:hover {
            background: #f5f5f5;
        }

        .gantt-table tr:focus-within {
            background: #e3f2fd;
            outline: 2px solid #2196f3;
        }

        .task-name {
            padding: 10px 15px;
            font-size: 13px;
            color: #2c3e50;
            font-weight: 500;
            background: white;
            border-right: 2px solid #90a4ae;
            min-width: 280px;
            position: sticky;
            left: 0;
            z-index: 5;
        }

        .phase-row td {
            background: #5e35b1;
            color: white;
            font-weight: 600;
            font-size: 14px;
            padding: 10px 15px;
            border: none;
        }

        .subtask {
            padding-left: 30px;
            color: #546e7a;
            font-size: 12px;
        }

        .timeline-cell {
            text-align: center;
            min-width: 50px;
            max-width: 70px;
            padding: 4px;
            position: relative;
        }

        .bar {
            height: 24px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            position: relative;
            border: 2px solid transparent;
        }

        .bar:hover,
        .bar:focus {
            opacity: 0.85;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            outline: 2px solid #000;
            outline-offset: 2px;
        }

        /* High contrast patterns for color accessibility */
        .bar-research { 
            background: #1e88e5;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);
        }
        .bar-analysis { 
            background: #8e24aa;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 5px, rgba(255,255,255,0.1) 5px, rgba(255,255,255,0.1) 10px);
        }
        .bar-planning { 
            background: #e53935;
            background-image: repeating-linear-gradient(135deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);
        }
        .bar-design { 
            background: #fb8c00;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 5px, rgba(255,255,255,0.1) 5px, rgba(255,255,255,0.1) 10px);
        }
        .bar-development { 
            background: #43a047;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(0,0,0,0.1) 5px, rgba(0,0,0,0.1) 10px);
        }
        .bar-testing { 
            background: #00acc1;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);
        }
        .bar-launch { 
            background: #c62828;
            background-image: repeating-linear-gradient(135deg, transparent, transparent 5px, rgba(255,255,255,0.1) 5px, rgba(255,255,255,0.1) 10px);
        }
        .bar-accessibility {
            background: #6a1b9a;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(255,255,255,0.15) 8px, rgba(255,255,255,0.15) 16px);
        }

        .milestone {
            width: 20px;
            height: 20px;
            background: #d32f2f;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin: 0 auto;
            cursor: pointer;
        }

        .milestone:hover,
        .milestone:focus {
            transform: scale(1.15);
            outline: 2px solid #000;
            outline-offset: 2px;
        }

        .tooltip {
            position: fixed !important;
            background: rgba(0,0,0,0.95) !important;
            color: white !important;
            padding: 12px 16px !important;
            border-radius: 6px !important;
            font-size: 13px !important;
            z-index: 999999 !important;
            pointer-events: none !important;
            display: none !important;
            max-width: 280px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5) !important;
            border: 2px solid #2196f3 !important;
        }

        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .instructions {
            margin-top: 25px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
        }

        .instructions h3 {
            color: #2e7d32;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instructions ul {
            margin-left: 20px;
            color: #1b5e20;
        }

        .instructions li {
            margin-bottom: 5px;
            font-size: 13px;
        }

        .accessibility-note {
            margin-top: 25px;
            padding: 15px;
            background: #f3e5f5;
            border-radius: 4px;
            border-left: 4px solid #6a1b9a;
        }

        .accessibility-note h3 {
            color: #4a148c;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .accessibility-note p {
            color: #4a148c;
            font-size: 13px;
            line-height: 1.6;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .controls, .instructions, .btn, .skip-link {
                display: none;
            }
        }

        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 2px solid #2196f3;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
<a href="#main-content" class="skip-link">Skip to main content</a>

<div class="container">
    <header>
        <h1>EVPL Navigation Restructuring - Project Timeline</h1>
    </header>

    <div class="project-info" role="region" aria-label="Project Information">
        <p><strong>Start Date:</strong> <span id="projectStart"></span></p>
        <p><strong>End Date:</strong> <span id="projectEnd"></span></p>
        <p><strong>Duration:</strong> 16 weeks</p>
        <p><strong>Goal:</strong> Remove Discover/Explore/Connect layers and restructure site navigation with full accessibility compliance</p>
    </div>

    <div class="controls" role="region" aria-label="Chart Controls">
        <div class="control-group">
            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" aria-describedby="dateHelp">
            <span id="dateHelp" class="sr-only">Select a start date for the project. Chart will update automatically.</span>
        </div>
        <button class="btn" onclick="updateChart()" aria-label="Update chart with selected date">Update Chart</button>
        <button class="btn export" onclick="exportCSV()" aria-label="Export chart data to CSV file">Export to CSV</button>
        <button class="btn" onclick="window.print()" aria-label="Print this page">Print</button>
    </div>

    <div class="legend" role="region" aria-label="Task Type Legend">
        <div class="legend-item">
            <div class="legend-color bar-research" role="img" aria-label="Research task color: blue with diagonal stripes"></div>
            <span>Research</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-analysis" role="img" aria-label="Analysis task color: purple with vertical stripes"></div>
            <span>Analysis</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-planning" role="img" aria-label="Planning task color: red with diagonal stripes"></div>
            <span>Planning</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-design" role="img" aria-label="Design task color: orange with horizontal stripes"></div>
            <span>Design</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-development" role="img" aria-label="Development task color: green with diagonal stripes"></div>
            <span>Development</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-testing" role="img" aria-label="Testing task color: cyan with vertical stripes"></div>
            <span>Testing</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-accessibility" role="img" aria-label="Accessibility task color: dark purple with diagonal stripes"></div>
            <span>Accessibility</span>
        </div>
        <div class="legend-item">
            <div class="legend-color bar-launch" role="img" aria-label="Launch task color: dark red with diagonal stripes"></div>
            <span>Launch</span>
        </div>
        <div class="legend-item">
            <div class="milestone" role="img" aria-label="Milestone marker: red circle"></div>
            <span>Milestone</span>
        </div>
    </div>

    <main id="main-content">
        <div class="gantt-wrapper">
            <table class="gantt-table" id="ganttTable" role="table" aria-label="Project Gantt Chart">
                <thead>
                <tr id="headerRow">
                    <th scope="col">Task Name</th>
                </tr>
                </thead>
                <tbody id="ganttBody">
                </tbody>
            </table>
        </div>
    </main>

    <div class="accessibility-note" role="region" aria-label="Accessibility Integration">
        <h3>â™¿ Accessibility Integration Throughout Project</h3>
        <p><strong>This revised timeline integrates accessibility throughout all phases</strong> rather than treating it as an afterthought. Accessibility considerations inform research, design decisions, development practices, and testing protocols from day one. Purple accessibility tasks run parallel to primary work streams, ensuring WCAG 2.1 AA compliance is built into the foundation of the new navigation system.</p>
    </div>

    <div class="instructions" role="region" aria-label="Instructions">
        <h3>How to Use This Chart</h3>
        <ul>
            <li>Use Tab key to navigate through interactive elements</li>
            <li>Set your project start date and click "Update Chart" or press Enter</li>
            <li>Click or press Enter/Space on colored bars and milestones to see task details</li>
            <li>Export to CSV to import into project management software</li>
            <li>Print for reference or team meetings</li>
            <li>Screen reader users: Task information is announced as you navigate the table</li>
        </ul>
    </div>
</div>

<div class="tooltip" id="tooltip" role="tooltip" aria-live="polite"></div>

<script>
    const tasks = [
        { phase: 'Phase 1: Research & Analysis (Weeks 1-3)', isPhase: true },
        { name: 'Current State Audit', type: 'research', start: 1, weeks: 2 },
        { name: 'Accessibility Audit (Current Site)', type: 'accessibility', start: 1, weeks: 1 },
        { name: 'Tree Testing (Current Nav)', type: 'research', start: 2, weeks: 1 },
        { name: 'Open Card Sort', type: 'research', start: 3, weeks: 1 },
        { name: 'Competitor Analysis', type: 'analysis', start: 3, weeks: 1 },
        { name: 'Recruit Users with Disabilities', type: 'accessibility', start: 2, weeks: 1 },

        { phase: 'Phase 2: Information Architecture (Weeks 4-7)', isPhase: true },
        { name: 'Content Inventory & Tagging', type: 'analysis', start: 4, weeks: 2 },
        { name: 'Design New Sitemap (Remove D/E/C)', type: 'planning', start: 5, weeks: 2 },
        { name: 'Define Accessible IA Principles', type: 'accessibility', start: 4, weeks: 1 },
        { name: 'Closed Card Sort', type: 'testing', start: 6, weeks: 1 },
        { name: 'Tree Testing (New Nav)', type: 'testing', start: 7, weeks: 1 },
        { name: 'Tree Test with Screen Readers', type: 'accessibility', start: 7, weeks: 1 },
        { name: 'âœ“ Stakeholder Approval', type: 'milestone', start: 7 },

        { phase: 'Phase 3: Navigation Design (Weeks 8-11)', isPhase: true },
        { name: 'Desktop Navigation Design', type: 'design', start: 8, weeks: 2 },
        { name: 'Mobile Navigation Design', type: 'design', start: 9, weeks: 2 },
        { name: 'Design Keyboard Navigation Flow', type: 'accessibility', start: 8, weeks: 1 },
        { name: 'Design Focus Indicators & Skip Links', type: 'accessibility', start: 9, weeks: 1 },
        { name: 'Color Contrast & Text Sizing', type: 'accessibility', start: 9, weeks: 1 },
        { name: 'Create Interactive Prototypes', type: 'design', start: 10, weeks: 1 },
        { name: 'User Testing - Prototypes', type: 'testing', start: 11, weeks: 1 },
        { name: 'Accessibility Design Review', type: 'accessibility', start: 11, weeks: 1 },

        { phase: 'Phase 4: Analytics & Prep (Weeks 10-13)', isPhase: true },
        { name: 'Learn GA4 Basics & Best Practices', type: 'research', start: 10, weeks: 1 },
        { name: 'Configure GA4 Property & Data Streams', type: 'development', start: 11, weeks: 1 },
        { name: 'Set Up Events & Conversions', type: 'development', start: 12, weeks: 1 },
        { name: 'Test GA4 with Assistive Tech', type: 'accessibility', start: 12, weeks: 1 },
        { name: 'Test GA4 Tracking & Validation', type: 'testing', start: 13, weeks: 1 },
        { name: 'Redirect Mapping (ALL URLs)', type: 'planning', start: 10, weeks: 2 },
        { name: 'Implementation Documentation', type: 'planning', start: 11, weeks: 2 },

        { phase: 'Phase 5: Development & Testing (Weeks 13-15)', isPhase: true },
        { name: 'âœ“ COMPLETE BACKUP', type: 'milestone', start: 13 },
        { name: 'WordPress Menu Updates (STAGING)', type: 'development', start: 13, weeks: 2 },
        { name: 'Implement ARIA Labels & Landmarks', type: 'accessibility', start: 13, weeks: 1 },
        { name: 'CSS/JavaScript Development', type: 'development', start: 13, weeks: 2 },
        { name: 'Keyboard Navigation Implementation', type: 'accessibility', start: 14, weeks: 1 },
        { name: 'Implement 301 Redirects', type: 'development', start: 14, weeks: 1 },
        { name: 'Update Internal Links', type: 'development', start: 14, weeks: 1 },
        { name: 'Cross-Browser & Device Testing', type: 'testing', start: 15, weeks: 1 },
        { name: 'Screen Reader Testing (NVDA/JAWS)', type: 'accessibility', start: 15, weeks: 1 },
        { name: 'Keyboard-Only Navigation Testing', type: 'accessibility', start: 15, weeks: 1 },
        { name: 'WCAG 2.1 AA Compliance Validation', type: 'accessibility', start: 15, weeks: 1 },
        { name: 'User Acceptance Testing', type: 'testing', start: 15, weeks: 1 },
        { name: 'Bug Fixes & Refinements', type: 'development', start: 15, weeks: 1 },

        { phase: 'Phase 6: Launch & Monitoring (Week 16+)', isPhase: true },
        { name: 'ðŸš€ LAUNCH NEW NAVIGATION', type: 'milestone', start: 16 },
        { name: 'Monitor 404 Errors', type: 'testing', start: 16, weeks: 1 },
        { name: 'Analytics Review', type: 'analysis', start: 16, weeks: 1 },
        { name: 'Monitor Accessibility Feedback', type: 'accessibility', start: 16, weeks: 1 },
        { name: 'Submit Updated Sitemap', type: 'launch', start: 16, weeks: 1 },
        { name: 'Staff Training (Including A11y)', type: 'planning', start: 16, weeks: 1 }
    ];

    let projectStart = new Date();
    const totalWeeks = 16;

    function initialize() {
        const today = new Date();
        const dayOfWeek = today.getDay();
        const daysToNextMonday = (8 - dayOfWeek) % 7 || 7;
        projectStart = new Date(today.getTime() + daysToNextMonday * 24 * 60 * 60 * 1000);

        const startDateInput = document.getElementById('startDate');
        startDateInput.valueAsDate = projectStart;
        
        // Add event listener for automatic updates
        startDateInput.addEventListener('change', function() {
            updateChart();
        });
        
        startDateInput.addEventListener('input', function() {
            updateChart();
        });
        
        updateChart();
    }

    function updateChart() {
        const dateInput = document.getElementById('startDate').value;
        
        if (dateInput) {
            // Parse date ensuring correct timezone
            const parts = dateInput.split('-');
            projectStart = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        }

        const projectEnd = new Date(projectStart.getTime());
        projectEnd.setDate(projectEnd.getDate() + (totalWeeks * 7));

        document.getElementById('projectStart').textContent = formatDate(projectStart);
        document.getElementById('projectEnd').textContent = formatDate(projectEnd);

        // Re-render the entire chart with new dates
        renderGanttChart();
    }

    function formatDate(date) {
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    function renderGanttChart() {
        const headerRow = document.getElementById('headerRow');
        const tbody = document.getElementById('ganttBody');

        // Build header
        headerRow.innerHTML = '<th scope="col">Task Name</th>';
        for (let i = 1; i <= totalWeeks; i++) {
            const weekStart = getTaskDate(i);
            headerRow.innerHTML += `<th scope="col" aria-label="Week ${i}, starting ${formatDate(weekStart)}">W${i}</th>`;
        }

        // Build body
        tbody.innerHTML = '';

        tasks.forEach((task, taskIndex) => {
            const row = document.createElement('tr');

            if (task.isPhase) {
                row.className = 'phase-row';
                const cell = document.createElement('td');
                cell.colSpan = totalWeeks + 1;
                cell.textContent = task.phase;
                cell.setAttribute('role', 'rowheader');
                row.appendChild(cell);
            } else {
                // Task name
                const nameCell = document.createElement('td');
                nameCell.className = 'task-name';
                if (task.type !== 'milestone') {
                    nameCell.classList.add('subtask');
                }
                nameCell.textContent = task.name;
                nameCell.setAttribute('scope', 'row');
                row.appendChild(nameCell);

                // Week cells
                for (let week = 1; week <= totalWeeks; week++) {
                    const cell = document.createElement('td');
                    cell.className = 'timeline-cell';

                    if (task.type === 'milestone' && week === task.start) {
                        const milestone = document.createElement('button');
                        milestone.className = 'milestone';
                        milestone.setAttribute('tabindex', '0');
                        milestone.setAttribute('aria-label', `Milestone: ${task.name} on ${formatDate(getTaskDate(task.start))}`);
                        milestone.addEventListener('click', (e) => showTooltip(e, task));
                        milestone.addEventListener('mouseenter', (e) => showTooltip(e, task));
                        milestone.addEventListener('mouseleave', hideTooltip);
                        milestone.addEventListener('mousemove', (e) => updateTooltipPosition(e));
                        milestone.addEventListener('focus', (e) => showTooltip(e, task));
                        milestone.addEventListener('blur', hideTooltip);
                        cell.appendChild(milestone);
                    } else if (task.weeks && week >= task.start && week < task.start + task.weeks) {
                        const bar = document.createElement('button');
                        bar.className = `bar bar-${task.type}`;
                        bar.setAttribute('tabindex', '0');
                        const startDate = getTaskDate(task.start);
                        const endDate = getTaskDate(task.start + task.weeks);
                        bar.setAttribute('aria-label', `${task.name}, ${capitalizeFirst(task.type)}, from ${formatDate(startDate)} to ${formatDate(endDate)}, ${task.weeks} week${task.weeks > 1 ? 's' : ''}`);
                        
                        // Add events to both bar and cell for reliability
                        const showFn = (e) => showTooltip(e, task);
                        const moveFn = (e) => updateTooltipPosition(e);
                        
                        bar.addEventListener('click', showFn);
                        bar.addEventListener('mouseenter', showFn);
                        bar.addEventListener('mouseleave', hideTooltip);
                        bar.addEventListener('mousemove', moveFn);
                        bar.addEventListener('focus', showFn);
                        bar.addEventListener('blur', hideTooltip);
                        
                        cell.addEventListener('mouseenter', showFn);
                        cell.addEventListener('mouseleave', hideTooltip);
                        cell.addEventListener('mousemove', moveFn);
                        
                        cell.appendChild(bar);
                    }

                    row.appendChild(cell);
                }
            }

            tbody.appendChild(row);
        });
    }

    function showTooltip(e, task) {
        const tooltip = document.getElementById('tooltip');
        const startDate = getTaskDate(task.start);

        let content = `<strong>${task.name}</strong><br>`;
        content += `Type: ${capitalizeFirst(task.type)}<br>`;
        content += `Start: ${formatDate(startDate)}`;

        if (task.weeks) {
            const endDate = getTaskDate(task.start + task.weeks);
            content += `<br>End: ${formatDate(endDate)}`;
            content += `<br>Duration: ${task.weeks} week${task.weeks > 1 ? 's' : ''}`;
        }

        tooltip.innerHTML = content;
        
        // Set multiple style properties aggressively
        tooltip.style.cssText = `
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: fixed !important;
            z-index: 999999 !important;
            background: rgba(0,0,0,0.95) !important;
            color: white !important;
            padding: 12px 16px !important;
            border-radius: 6px !important;
            font-size: 13px !important;
            pointer-events: none !important;
            max-width: 280px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5) !important;
            border: 2px solid #2196f3 !important;
        `;
        
        updateTooltipPosition(e);
    }

    function updateTooltipPosition(e) {
        const tooltip = document.getElementById('tooltip');
        
        // Use clientX/clientY (viewport position) instead of pageX/pageY (document position)
        let left = e.clientX + 15;
        let top = e.clientY + 15;
        
        // Get tooltip dimensions
        const tooltipRect = tooltip.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        
        // Adjust if tooltip goes off right edge
        if (left + tooltipRect.width > viewportWidth) {
            left = e.clientX - tooltipRect.width - 15;
        }
        
        // Adjust if tooltip goes off bottom edge
        if (top + tooltipRect.height > viewportHeight) {
            top = e.clientY - tooltipRect.height - 15;
        }
        
        // Make sure it doesn't go off left edge
        if (left < 0) {
            left = 10;
        }
        
        // Make sure it doesn't go off top edge
        if (top < 0) {
            top = 10;
        }
        
        tooltip.style.setProperty('left', left + 'px', 'important');
        tooltip.style.setProperty('top', top + 'px', 'important');
    }

    function hideTooltip() {
        const tooltip = document.getElementById('tooltip');
        tooltip.style.setProperty('display', 'none', 'important');
    }

    function getTaskDate(weekNumber) {
        // Create a fresh date object from projectStart
        const date = new Date(projectStart.getFullYear(), projectStart.getMonth(), projectStart.getDate());
        date.setDate(date.getDate() + ((weekNumber - 1) * 7));
        return date;
    }

    function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
    }

    function exportCSV() {
        let csv = 'Phase,Task,Type,Start Week,Duration,Start Date,End Date\n';

        let currentPhase = '';
        tasks.forEach(task => {
            if (task.isPhase) {
                currentPhase = task.phase;
            } else {
                const startDate = getTaskDate(task.start);
                const endDate = task.weeks ? getTaskDate(task.start + task.weeks) : startDate;
                const duration = task.weeks || 0;

                csv += `"${currentPhase}","${task.name}","${task.type}",${task.start},${duration},"${startDate.toLocaleDateString()}","${endDate.toLocaleDateString()}"\n`;
            }
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `EVPL_Navigation_Gantt_Accessible_${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        URL.revokeObjectURL(url);
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Alt + E for Export
        if (e.altKey && e.key === 'e') {
            e.preventDefault();
            exportCSV();
        }
        // Alt + P for Print
        if (e.altKey && e.key === 'p') {
            e.preventDefault();
            window.print();
        }
    });

    window.addEventListener('load', initialize);
</script>
</body>
</html>